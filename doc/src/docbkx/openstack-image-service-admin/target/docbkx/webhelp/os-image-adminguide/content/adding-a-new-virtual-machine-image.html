<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng"><head>
<meta http-equiv="X-UA-Compatible" content="IE=7"/>
<title>Adding a New Virtual Machine Image</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><link rel="home" href="index.html" title="OpenStack Image Service Admin Manual"/><link rel="up" href="using-glance-programmatically-with-glances-client.html" title="Chapter 10. Using Glance Programmatically with Glance's Client"/><link rel="prev" href="retrieving-a-virtual-machine-image.html" title="Retrieving a Virtual Machine Image"/><link rel="next" href="requesting-image-memberships.html" title="Requesting Image Memberships"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "treeview-2723";
            var language = "en";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Your browser is not supported. Use of Mozilla Firefox is recommended.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
        </script><style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
            
        </style><link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"/><link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/><!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
	<![endif]--><link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/><link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/><script type="text/javascript" src="../common/jquery/jquery-1.4.2.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script><script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script><script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script><script type="text/javascript" src="search/htmlFileList.js"><!----></script><script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script><script type="text/javascript" src="search/nwSearchFnt.js"><!----></script><script type="text/javascript" src="search/stemmers/en_stemmer.js"><!--//make this scalable to other languages as well.--></script><script type="text/javascript" src="search/index-1.js"><!----></script><script type="text/javascript" src="search/index-2.js"><!----></script><script type="text/javascript" src="search/index-3.js"><!----></script><script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-17511903-6']);
	  </script><script type="text/javascript" src="../common/ga.js"><!----></script></head><body><div id="header"><a onclick="_gaq.push(['_trackEvent', 'Header', 'logo', 'click', 1]);" target="_blank" href="http://www.openstack.org"><img src="../common/images/openstack-logo.png" alt="OpenStack Documentation" width="157" height="47"/></a><p class="breadcrumbs"><a href="http://docs.openstack.org/">OpenStack Manuals</a><a href="index.html">OpenStack Image Service Admin Manual
   - trunk</a></p><h1>Adding a New Virtual Machine Image</h1><div id="navheader" align="right"><!----><table class="navLinks"><tr><td><a id="showHideButton" onclick="showHideToc(); _gaq.push(['_trackEvent', 'Header', 'show/hide', 'click', 1]);" class="pointLeft" title="Hide TOC tree">Sidebar
                            </a></td><td><a accesskey="p" class="navLinkPrevious" onclick="_gaq.push(['_trackEvent', 'Header', 'prevLink', 'click', 1]);" tabindex="5" href="retrieving-a-virtual-machine-image.html">Prev</a>
				      |
                                        <a accesskey="u" class="navLinkUp" onclick="_gaq.push(['_trackEvent', 'Header', 'upLink', 'click', 1]);" tabindex="5" href="using-glance-programmatically-with-glances-client.html">Up</a>
				  |
                                    <a accesskey="n" class="navLinkNext" onclick="_gaq.push(['_trackEvent', 'Header', 'nextLink', 'click', 1]);" tabindex="5" href="requesting-image-memberships.html">Next</a></td></tr></table></div></div><div id="content"><div class="statustext"> </div><div class="section" title="Adding a New Virtual Machine Image"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="adding-a-new-virtual-machine-image"/>Adding a New Virtual Machine Image</h2></div></div></div><p>
      We have created a new virtual machine image in some way (created a
      "golden image" or snapshotted/backed up an existing
      image) and we wish to do two things:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
          Store the disk image data in Glance
        </p></li><li class="listitem"><p>
          Store metadata about this image in Glance
        </p></li></ul></div><p>
      We can do the above two activities in a single call to the Glance
      client. Assuming, like in the examples above, that a Glance API
      server is running at `glance.example.com`, we issue a call to
      `glance.client.Client.add_image`.
    </p><p>
      The method signature is as follows:
    </p><pre class="screen">
glance.client.Client.add_image(image_meta, image_data=None)
</pre><p>
      The `image_meta` argument is a mapping containing various image
      metadata. The `image_data` argument is the disk image data and is
      an optional argument.
    </p><p>
      The list of metadata that `image_meta` can contain are listed
      below.
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
          `name`
        </p><p>
          This key/value is required. Its value should be the name of
          the image.
        </p><p>
          Note that the name of an image <span class="emphasis"><em>is not unique to a
          Glance node</em></span>. It would be an unrealistic expectation
          of users to know all the unique names of all other user's
          images.
        </p></li><li class="listitem"><p>
          `id`
        </p><p>
          This key/value is optional.
        </p><p>
          When present, Glance will use the supplied identifier for the
          image. If the identifier already exists in that Glance node,
          then a `glance.common.exception.Duplicate` will be raised.
        </p><p>
          When this key/value is <span class="emphasis"><em>not</em></span> present,
          Glance will generate an identifier for the image and return
          this identifier in the response (see below)
        </p></li><li class="listitem"><p>
          `store`
        </p><p>
          This key/value is optional. Valid values are one of `file`,
          `s3` or `swift`
        </p><p>
          When present, Glance will attempt to store the disk image data
          in the backing store indicated by the value. If the Glance
          node does not support the backing store, Glance will raise a
          `glance.common.exception.BadRequest`
        </p><p>
          When not present, Glance will store the disk image data in the
          backing store that is marked default. See the configuration
          option `default_store` for more information.
        </p></li><li class="listitem"><p>
          `type`
        </p><p>
          This key/values is required. Valid values are one of `kernel`,
          `machine`, `raw`, or `ramdisk`.
        </p></li><li class="listitem"><p>
          `size`
        </p><p>
          This key/value is optional.
        </p><p>
          When present, Glance assumes that the expected size of the
          request body will be the value. If the length in bytes of the
          request body <span class="emphasis"><em>does not match</em></span> the value,
          Glance will raise a `glance.common.exception.BadRequest`
        </p><p>
          When not present, Glance will calculate the image's size based
          on the size of the request body.
        </p></li><li class="listitem"><p>
          `is_public`
        </p><p>
          This key/value is optional.
        </p><p>
          When present, Glance converts the value to a boolean value, so
          "on, 1, true" are all true values. When true, the
          image is marked as a public image, meaning that any user may
          view its metadata and may read the disk image from Glance.
        </p><p>
          When not present, the image is assumed to be <span class="emphasis"><em>not
          public</em></span> and specific to a user.
        </p></li><li class="listitem"><p>
          `properties`
        </p><p>
          This key/value is optional.
        </p><p>
          When present, the value is assumed to be a mapping of
          free-form key/value attributes to store with the image.
        </p><p>
          For example, if the following is the value of the `properties`
          key in the `image_meta` argument:
        </p><pre class="screen">
{'distro': 'Ubuntu 10.10'}
</pre><p>
          Then a key/value pair of "distro"/"Ubuntu
          10.10" will be stored with the image in Glance.
        </p><p>
          There is no limit on the number of free-form key/value
          attributes that can be attached to the image with
          `properties`. However, keep in mind that there is a 8K limit
          on the size of all HTTP headers sent in a request and this
          number will effectively limit the number of image properties.
        </p><p>
          If the `image_data` argument is omitted, Glance will add the
          `image_meta` mapping to its registries and return the
          newly-registered image metadata, including the new image's
          identifier. The `status` of the image will be set to the value
          `queued`.
        </p></li></ul></div><p>
      As a complete example, the following code would add a new machine
      image to Glance
    </p><p>
        from glance.client import Client
      </p><p>
        c = Client("glance.example.com", 9292)
      </p><div class="variablelist"><dl><dt><span class="term">
            meta = {'name': 'Ubuntu 10.10 5G',
          </span></dt><dd><p>
              'type': 'machine', 'is_public': True, 'properties':
              {'distro': 'Ubuntu 10.10'}}
            </p></dd></dl></div><p>
        new_meta = c.add_image(meta, open('/path/to/image.tar.gz'))
      </p><p>
        print 'Stored image. Got identifier: %s' % new_meta['id']
      </p></div><script type="text/javascript" src="../common/main.js"><!----></script><hr/><div id="disqus_thread"><script type="text/javascript">
	      var disqus_shortname = 'openstackdocs';
	        
	      var disqus_identifier = 'openstack-image-service-admin-manualadding-a-new-virtual-machine-image';
	        </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><script type="text/javascript" src="../common/comments.js"><!----></script></div><hr/><div class="legal"><a href="index.html">Legal notices</a></div></div><div><div id="leftnavigation" style="padding-top:3px; background-color:white;"><div id="tabs"><ul><li><a href="#treeDiv" tabindex="1"><span class="contentsTab">Contents</span></a></li><li><a href="#searchDiv" tabindex="1"><span class="searchTab">Search</span></a></li></ul><div id="treeDiv"><img src="../common/images/loading.gif" alt="loading table of contents..." id="tocLoading" style="display:block;"/><div id="ulTreeDiv" style="display:none" class="thisisthat"><ul id="tree" class="filetree"><li tabindex="2"><span class="file"><a href="quick-guide-to-getting-started-with-glance.html">1. Quick Guide to Getting Started with Glance</a></span><ul><li tabindex="2"><span class="file"><a href="overview-of-glance-architecture.html">Overview of Glance Architecture</a></span><ul><li tabindex="2"><span class="file"><a href="glance-api-server.html">Glance API Server</a></span></li><li tabindex="2"><span class="file"><a href="glance-registry-servers.html">Glance Registry Servers</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="installing-glance.html">2. Installing Glance</a></span><ul><li tabindex="2"><span class="file"><a href="installing-from-packages.html">Installing from packages</a></span><ul><li tabindex="2"><span class="file"><a href="debianubuntu.html">Debian/Ubuntu</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="installing-from-source-tarballs.html">Installing from source tarballs</a></span></li><li tabindex="2"><span class="file"><a href="installing-from-a-bazaar-branch.html">Installing from a Bazaar Branch</a></span><ul><li tabindex="2"><span class="file"><a href="debianubuntu-1.html">Debian/Ubuntu</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="image-identifiers.html">3. Image Identifiers</a></span></li><li tabindex="2"><span class="file"><a href="image-registries.html">4. Image Registries</a></span><ul><li tabindex="2"><span class="file"><a href="glance-registry-api.html">Glance Registry API</a></span><ul><li tabindex="2"><span class="file"><a href="api-in-summary.html">API in Summary</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="filtering-images-returned-via-get-images-and-get-imagesdetail.html">Filtering Images Returned via GET /images
    and GET /images/detail</a></span></li><li tabindex="2"><span class="file"><a href="post-images.html">POST /images</a></span><ul><li tabindex="2"><span class="file"><a href="examples.html">Examples</a></span></li></ul></li></ul></li><li tabindex="2"><span class="file"><a href="image-statuses.html">5. Image Statuses</a></span></li><li tabindex="2"><span class="file"><a href="disk-and-container-formats.html">6. Disk and Container Formats</a></span><ul><li tabindex="2"><span class="file"><a href="disk-format.html">Disk Format</a></span></li><li tabindex="2"><span class="file"><a href="container-format.html">Container Format</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="controlling-glance-servers.html">7. Controlling Glance Servers</a></span><ul><li tabindex="2"><span class="file"><a href="starting-a-server.html">Starting a server</a></span><ul><li tabindex="2"><span class="file"><a href="manually-starting-the-server.html">Manually starting the server</a></span></li><li tabindex="2"><span class="file"><a href="using-the-glance-control-program-to-start-the-server.html">Using the glance-control program to
      start the server</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="stopping-a-server.html">Stopping a server</a></span></li><li tabindex="2"><span class="file"><a href="restarting-a-server.html">Restarting a server</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="configuring-glance.html">8. Configuring Glance</a></span><ul><li tabindex="2"><span class="file"><a href="common-configuration-options-in-glance.html">Common Configuration Options in Glance</a></span></li><li tabindex="2"><span class="file"><a href="configuring-logging-in-glance.html">Configuring Logging in Glance</a></span><ul><li tabindex="2"><span class="file"><a href="logging-options-available-only-in-configuration-files.html">Logging Options Available Only in Configuration
      Files</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="configuring-glance-storage-backends.html">Configuring Glance Storage Backends</a></span><ul><li tabindex="2"><span class="file"><a href="configuring-the-filesystem-storage-backend.html">Configuring the Filesystem Storage Backend</a></span></li><li tabindex="2"><span class="file"><a href="configuring-the-swift-storage-backend.html">Configuring the Swift Storage Backend</a></span></li><li tabindex="2"><span class="file"><a href="configuring-the-s3-storage-backend.html">Configuring the S3 Storage Backend</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="configuring-the-glance-registry.html">Configuring the Glance Registry</a></span></li><li tabindex="2"><span class="file"><a href="configuring-notifications.html">Configuring Notifications</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="using-the-glance-cli-tool.html">9. Using the Glance CLI Tool</a></span><ul><li tabindex="2"><span class="file"><a href="the-help-command.html">The help command</a></span></li><li tabindex="2"><span class="file"><a href="the-add-command.html">The add command</a></span><ul><li tabindex="2"><span class="file"><a href="important-information-about-uploading-images.html">Important Information about Uploading Images</a></span></li><li tabindex="2"><span class="file"><a href="store-virtual-machine-image-data-and-metadata.html">Store virtual machine image data and metadata</a></span></li><li tabindex="2"><span class="file"><a href="register-a-virtual-machine-image-in-another-location.html">Register a virtual machine image in another
      location</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="the-update-command.html">The update command</a></span></li><li tabindex="2"><span class="file"><a href="the-delete-command.html">The delete command</a></span></li><li tabindex="2"><span class="file"><a href="the-index-command.html">The index command</a></span></li><li tabindex="2"><span class="file"><a href="the-details-command.html">The details command</a></span></li><li tabindex="2"><span class="file"><a href="the-show-command.html">The show command</a></span></li><li tabindex="2"><span class="file"><a href="the-clear-command.html">The clear command</a></span></li><li tabindex="2"><span class="file"><a href="the-image-members-command.html">The image-members Command</a></span></li><li tabindex="2"><span class="file"><a href="the-member-images-command.html">The member-images Command</a></span></li><li tabindex="2"><span class="file"><a href="the-member-add-command.html">The member-add Command</a></span></li><li tabindex="2"><span class="file"><a href="the-member-delete-command.html">The member-delete Command</a></span></li><li tabindex="2"><span class="file"><a href="the-members-replace-command.html">The members-replace Command</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="using-glance-programmatically-with-glances-client.html">10. Using Glance Programmatically with Glance's Client</a></span><ul><li tabindex="2"><span class="file"><a href="requesting-a-list-of-public-vm-images.html">Requesting a List of Public VM Images</a></span></li><li tabindex="2"><span class="file"><a href="requesting-detailed-metadata-on-public-vm-images.html">Requesting Detailed Metadata on Public VM Images</a></span></li><li tabindex="2"><span class="file"><a href="filtering-images-returned-via-get_images-and-get_images_detailed.html">Filtering Images Returned via get_images()
    and get_images_detailed()</a></span></li><li tabindex="2"><span class="file"><a href="sorting-images-returned-via-get_images-and-get_images_detailed.html">Sorting Images Returned via get_images()
    and get_images_detailed()</a></span></li><li tabindex="2"><span class="file"><a href="requesting-detailed-metadata-on-a-specific-image.html">Requesting Detailed Metadata on a Specific Image</a></span></li><li tabindex="2"><span class="file"><a href="retrieving-a-virtual-machine-image.html">Retrieving a Virtual Machine Image</a></span></li><li tabindex="2" id="webhelp-currentid"><span class="file"><a href="adding-a-new-virtual-machine-image.html">Adding a New Virtual Machine Image</a></span></li><li tabindex="2"><span class="file"><a href="requesting-image-memberships.html">Requesting Image Memberships</a></span></li><li tabindex="2"><span class="file"><a href="requesting-member-images.html">Requesting Member Images</a></span></li><li tabindex="2"><span class="file"><a href="adding-a-member-to-an-image.html">Adding a Member To an Image</a></span></li><li tabindex="2"><span class="file"><a href="removing-a-member-from-an-image.html">Removing a Member From an Image</a></span></li><li tabindex="2"><span class="file"><a href="replacing-a-membership-list-for-an-image.html">Replacing a Membership List For an Image</a></span></li></ul></li><li tabindex="2"><span class="file"><a href="glance-authentication-with-keystone.html">11. Glance Authentication With Keystone</a></span><ul><li tabindex="2"><span class="file"><a href="sharing-images-with-others.html">Sharing Images With Others</a></span></li></ul></li></ul></div></div><div id="searchDiv"><div id="search"><form onsubmit="Verifie(ditaSearch_Form);return false" name="ditaSearch_Form" class="searchForm"><fieldset class="searchFieldSet"><legend>Search</legend><center><input id="textToSearch" name="textToSearch" type="text" class="searchText"/> &nbsp; <input onclick="Verifie(ditaSearch_Form)" type="button" class="searchButton" value="Go" id="doSearch"/></center></fieldset></form></div><div id="searchResults"><center/></div><p class="searchHighlight"><a href="#" onclick="toggleHighlight()">Search Highlighter (On/Off)</a></p></div></div></div></div></body></html>