<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    version="5.0"
    xml:id="trove-manage-db">
    <?dbhtml stop-chunking?>
    <title>Create and manage databases</title>
    <para>The Database service provides scalable and reliable cloud provisioning functionality for both relational and non-relational database engines. Users can quickly and easily use database features without the burden of handling complex administrative tasks.</para>
    <section xml:id="create_db">
        <title>Create and access a database</title>
        <para>Assuming you have already installed the Database service and stocked your datastore with images for the type and versions of databases you want, you can create and access a database. This example shows you how to create and access a MySQL 5.5 database.</para>
        <procedure>
          <title>To create and access a database</title>
          <step>
            <formalpara>
              <title>Determine the flavor to use for your database.</title>
              <para>When you create a database instance, you must specify a nova flavor. The flavor indicates various characteristics of the instance, such as RAM, root volume size, and so on. The default nova flavors do not cover what you need for database instances. Therefore, you may need to create (or obtain) some new nova flavors that will work for databases.</para>
              </formalpara>
              <para>The first step is to list the existing flavors, using the nova <command>flavor-list</command> command. Here are the default flavors, although you may have additional custom flavors in your environment:</para>
<screen><prompt>$</prompt> <userinput>nova flavor-list</userinput>
<computeroutput>+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
| ID | Name      | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |
+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
| 1  | m1.tiny   | 512       | 1    | 0         |      | 1     | 1.0         | True      |
| 2  | m1.small  | 2048      | 20   | 0         |      | 1     | 1.0         | True      |
| 3  | m1.medium | 4096      | 40   | 0         |      | 2     | 1.0         | True      |
| 4  | m1.large  | 8192      | 80   | 0         |      | 4     | 1.0         | True      |
| 5  | m1.xlarge | 16384     | 160  | 0         |      | 8     | 1.0         | True      |
+----+-----------+-----------+------+-----------+------+-------+-------------+-----------+
</computeroutput></screen>
<para>Now take a look at the minimum requirements for various database instances:</para>
<informaltable rules="all" width="60%">
    <col width="25%"/>
    <col width="25%"/>
    <col width="25%"/>
    <col width="25%"/>

<thead>
      <tr>
        <th>Database</th>
        <th>RAM (in MB)</th>
        <th>Disk (in GB)</th>
        <th>VCPUs</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <para>MySQL</para>
        </td>
        <td>
          <para>512</para>
        </td>
        <td>
          <para>5</para>
        </td>
        <td>
          <para>1</para>
        </td>
      </tr>
      <tr>
        <td>
          <para>Cassandra</para>
        </td>
        <td>
          <para>2048</para>
        </td>
        <td>
          <para>5</para>
        </td>
        <td>
          <para>1</para>
        </td>
      </tr>
      <tr>
        <td>
          <para>MongoDB</para>
        </td>
        <td>
          <para>1024</para>
        </td>
        <td>
          <para>5</para>
        </td>
        <td>
          <para>1</para>
        </td>
      </tr>
      <tr>
        <td>
          <para>Redis</para>
        </td>
        <td>
          <para>512</para>
        </td>
        <td>
          <para>5</para>
        </td>
        <td>
          <para>1</para>
        </td>
      </tr>
    </tbody>
    </informaltable>
    <itemizedlist>
      <listitem>
        <para>If you have a custom flavor that meets the needs of the database you want to create, you can simply use that flavor. In this case, skip the rest of this step and move on to the next step in this procedure.</para>
      </listitem>
      <listitem>
        <para>If your environment does not have a suitable flavor, an admin user needs to create a custom flavor, using the nova <command>flavor-create</command> command.</para>
    </listitem>
    </itemizedlist>
    <formalpara><title>MySQL example.</title> <para>This example creates a flavor that you can use with a MySQL database. This example has the following attributes:</para></formalpara>
<itemizedlist>
  <listitem><para>Flavor name: <literal>mysql_minimum</literal></para></listitem>
  <listitem><para>Flavor ID: You need to use an ID that is not already in use. In this example, IDs 1 through 5 are already in use, so the ID can be <literal>6</literal>.</para></listitem>
  <listitem><para>RAM: <literal>512</literal></para></listitem>
  <listitem><para>Root volume size in GB: <literal>5</literal></para></listitem>
  <listitem><para>Virtual CPUs: <literal>1</literal></para></listitem>
</itemizedlist>
<screen><prompt>$</prompt> <userinput>nova flavor-create mysql-minimum 6 512 5 1</userinput>
<computeroutput>+----+---------------+-----------+------+-----------+------+-------+-------------+-----------+
| ID | Name          | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |
+----+---------------+-----------+------+-----------+------+-------+-------------+-----------+
| 6  | mysql-minimum | 512       | 5    | 0         |      | 1     | 1.0         | True      |
+----+---------------+-----------+------+-----------+------+-------+-------------+-----------+
</computeroutput></screen>
          </step>

          <step>
            <formalpara>
              <title>Create a database instance.</title>
              <para>This example creates a database instance with the following characteristics:</para>
          </formalpara>
           <itemizedlist>
            <listitem><para>Name of the instance: <literal>mysql_instance_1</literal></para></listitem>
           <listitem><para>Database flavor: <literal>6</literal></para></listitem>
          </itemizedlist>
          <para>In addition, this command uses various options to specify that:</para>
          <itemizedlist>
            <listitem><para>The instance has a volume size of <literal>5</literal> (meaning 5 GB).</para></listitem>
            <listitem><para>It has a database called <literal>myDB</literal>.</para></listitem>
            <listitem><para>It has a user called <literal>userA</literal> with a password of <literal>password</literal>.</para></listitem>
            <listitem><para>The database is based on a datastore called <literal>mysql</literal> and a datastore_version called <literal>mysql-5.5</literal>.</para></listitem>
          </itemizedlist>
          <screen><prompt>$</prompt> <userinput>trove create mysql_instance_1 6 --size 5 --databases myDB \
    --users userA:password --datastore_version mysql-5.5 \
    --datastore mysql</userinput>
<computeroutput>+-------------------+---------------------------------------------------------------------------------------t------------------------------------------------------------------------------------------------------------------+
|      Property     |                                                                                                  Value                                                                                                  |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|      created      |                                                                                           2014-05-29T21:26:21                                                                                           |
|     datastore     |                                                                              {u'version': u'mysql-5.5', u'type': u'mysql'}                                                                              |
| datastore_version |                                                                                                mysql-5.5                                                                                                |
|       flavor      | {u'id': u'6', u'links': [{u'href': u'https://controller:8779/v1.0/46d0bc4fc32e4b9e8520f8fc62199f58/flavors/6', u'rel': u'self'}, {u'href': u'https://controller:8779/flavors/6', u'rel': u'bookmark'}]} |
|         id        |                                                                                   5599dad6-731e-44df-bb60-488da3da9cfe                                                                                  |
|        name       |                                                                                             mysql_instance_1                                                                                            |
|       status      |                                                                                                  BUILD                                                                                                  |
|      updated      |                                                                                           2014-05-29T21:26:21                                                                                           |
|       volume      |                                                                                               {u'size': 5}                                                                                              |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</computeroutput></screen>
          </step>

          <step>
            <formalpara>
              <title>Get the IP address of the database instance.</title>
              <para>First, use the trove <command>list</command> command to list all instances and their IDs:</para>
           </formalpara>
           <screen><prompt>$</prompt> <userinput>trove list</userinput>
           <computeroutput>
+--------------------------------------+------------------+-----------+-------------------+--------+-----------+------+
|                  id                  |       name       | datastore | datastore_version | status | flavor_id | size |
+--------------------------------------+------------------+-----------+-------------------+--------+-----------+------+
| 5599dad6-731e-44df-bb60-488da3da9cfe | mysql_instance_1 |   mysql   |     mysql-5.5     | BUILD  |     6     |  5   |
+--------------------------------------+------------------+-----------+-------------------+--------+-----------+------+
</computeroutput></screen>
            <para>This command returns the instance ID of your new instance. You can now pass in the instance ID with the trove <command>show</command> command to get the IP address of the instance. In this example, you would replace <replaceable>INSTANCE_ID</replaceable> with 5599dad6-731e-44df-bb60-488da3da9cfe.</para>
<screen><prompt>$</prompt> <userinput>trove show <replaceable>INSTANCE_ID</replaceable></userinput>
<computeroutput>+-------------------+--------------------------------------+
|      Property     |                Value                 |
+-------------------+--------------------------------------+
|      created      |         2014-05-29T21:26:21          |
|     datastore     |                mysql                 |
| datastore_version |              mysql-5.5               |
|       flavor      |                  6                   |
|         id        | 5599dad6-731e-44df-bb60-488da3da9cfe |
|         ip        |             172.16.200.2             |
|        name       |           mysql_instance_1           |
|       status      |                BUILD                 |
|      updated      |         2014-05-29T21:26:54          |
|       volume      |                  5                   |
+-------------------+--------------------------------------+

</computeroutput></screen>
          <para>This command returns the IP address of the database instance.</para>
          </step>

          <step>
            <formalpara>
              <title>Access the new database.</title>
              <para>You can now access the new database you just created (myDB) using typical database access commands. In this MySQL example, you would replace <replaceable>IP_ADDRESS</replaceable> with 172.16.200.2.</para>
            </formalpara>
            <screen><prompt>$</prompt> <userinput>mysql -u userA -ppassword -h <replaceable>IP_ADDRESS</replaceable> myDB</userinput></screen>
          </step>
      </procedure>
  </section>
</section>
